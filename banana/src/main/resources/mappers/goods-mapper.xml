<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace = "goodsMapper">

  <resultMap type="GoodsSell" id="goods_rm">
  	<id property="goodsNo" column="GOODS_NO" />
  	<result property="sellerNo" column="SELLER_NO" />
  	<result property="categoryNo" column="CATEGORY_NO" />
  	<result property="categoryName" column="" />
  	<result property="title" column="TITLE" />
  	<result property="sellPrice" column="SELL_PRICE" />
  	<result property="viewCount" column="VIEW_COUNT" />
  	<result property="description" column="DESCRIPTION" />
  	<result property="refreshedAt" column="REFRESHED_AT" />
  	<result property="createdAt" column="CREATED_AT" />
  	<result property="goodsDelFlag" column="GOODS_DEL_FL" />
  	<result property="imageNo" column="IMAGE_NO" />
  	<result property="imagePath" column="IMAGE_PATH" />
  	<result property="likeCount" column="LIKE_COUNT" />
  </resultMap>

  <select id="categoryPage" parameterType="_int" resultType="String">
    SELECT CATEGORY_NAME FROM CATEGORY
    WHERE CATEGORY_NO = #{categoryNo}
  </select>
  
  <select id="getListCount" parameterType="_int" resultType="_int">
    SELECT COUNT(*) FROM GOODS_SELL
    WHERE CATEGORY_NO = #{categoryNo}
    AND GOODS_DEL_FL = 'N'
  </select>
  
  <select id="selectGoodsList" parameterType="_int" resultMap="goods_rm">
    SELECT TITLE, SELL_PRICE, CREATED_AT,
    (SELECT IMAGE_PATH FROM GOODS_IMAGE GI WHERE IMG_ORDER = 0 AND GI.GOODS_NO = GS.GOODS_NO) IMAGE_PATH
    FROM GOODS_SELL GS
    WHERE CATEGORY_NO = #{categoryNo} AND GOODS_DEL_FL = 'N'
    ORDER BY CREATED_AT DESC
  </select>
  
  <select id="getAllListCount" resultType="_int">
  	SELECT COUNT(*) FROM GOODS_SELL
	WHERE GOODS_DEL_FL = 'N'
  </select>
  
  <select id="selectAllGoodsList" resultMap="goods_rm">
  	SELECT TITLE, SELL_PRICE, CREATED_AT,
	(SELECT COUNT(*) FROM GOODS_LIKE GL WHERE GL.GOODS_NO = GS.GOODS_NO) LIKE_COUNT,
	(SELECT IMAGE_PATH FROM GOODS_IMAGE GI WHERE IMG_ORDER = 0 AND GI.GOODS_NO = GS.GOODS_NO) IMAGE_PATH
	FROM GOODS_SELL GS
	WHERE GOODS_DEL_FL = 'N'
	ORDER BY LIKE_COUNT DESC, CREATED_AT DESC
  </select>
  
</mapper>