<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace = "boardMapper">


	<resultMap type="Board" id="board_rm">
	
		<id property="boardNo" column="BOARD_NO"/>
		
		<result property="boardTitle" column="BOARD_TITLE"/>
      <result property="boardContent" column="BOARD_CONTENT"/>
      <result property="boardCreateDate" column="B_CREATED_AT"/>
      <result property="boardUpdateDate" column="B_REFRESHED_AT"/>
      <result property="viewCount" column="VIEW_COUNT"/>
      <result property="commentCount" column="COMMENT_COUNT"/>
      <result property="memberNickname" column="MEMBER_NICKNAME"/>
      <result property="memberNo" column="MEMBER_NO"/>
      <result property="profileImage" column="PROFILE_IMG"/>
      <result property="thumbnail" column="THUMBNAIL"/>
	
	</resultMap>
	
	
	<select id="selectBoardType">
		SELECT BOARD_CODE, BOARD_NAME 
		FROM BOARD_TYPE
		ORDER BY 1
	</select>

  
  <select id="getListCount" parameterType="_int" resultType="_int">
  	SELECT COUNT(*) FROM BOARD b 
	WHERE BOARD_CODE = #{boardCode}
	AND BOARD_DEL_FL = 'N'
  </select>
  
  <select id="selectBoardList" parameterType="_int" resultMap="board_rm">
  	  SELECT BOARD_NO, BOARD_TITLE, MEMBER_NICKNAME, VIEW_COUNT, 
		<![CDATA[
		CASE  
      WHEN SYSDATE - B_CREATED_AT < 1/24/60
      THEN FLOOR( (SYSDATE - B_CREATED_AT) * 24 * 60 * 60 ) || '초 전'
      WHEN SYSDATE - B_CREATED_AT < 1/24
      THEN FLOOR( (SYSDATE - B_CREATED_AT) * 24 * 60) || '분 전'
      WHEN SYSDATE - B_CREATED_AT < 1
      THEN FLOOR( (SYSDATE - B_CREATED_AT) * 24) || '시간 전'
      ELSE TO_CHAR(B_CREATED_AT, 'YYYY-MM-DD')
   	END B_CREATED_AT, ]]>
	(SELECT COUNT(*) FROM "COMMENT" C
	WHERE BOARD_NO = B.BOARD_NO) COMMENT_COUNT,
	(SELECT IMG_PATH ||IMG_RENAME FROM BOARD_IMG bi 
	WHERE IMG_ORDER = 0
	AND BOARD_NO = B.BOARD_NO) THUMBNAIL
	FROM BOARD B 
	JOIN MEMBER USING(MEMBER_NO)
	WHERE BOARD_CODE = #{boardCode}
	AND BOARD_DEL_FL = 'N'
	ORDER BY BOARD_NO DESC
  </select>
  
  
</mapper>
